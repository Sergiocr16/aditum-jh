<div ng-if="!vm.isReady" layout="row" class="content-loader" layout-sm="column" layout-fill
     layout-align="space-around center">
    <md-progress-circular md-mode="indeterminate" md-diameter="90px"></md-progress-circular>
</div>

<md-card ng-if="vm.isReady" class="fade-in gray-font" style="margin-bottom: 40px!important" md-theme-watch
         class="form-wrapper">
    <md-card-title hide-sm hide-xs layout-align="space-between center">
        <md-card-title-text hide-sm hide-xs>
            <span class="md-headline">
                <i class="material-icons material-icons-with-text" hide-sm hide-xs
                   ng-click="back()">arrow_back</i>Detalle de pago</span>
        </md-card-title-text>
    </md-card-title>
    <md-card-content  style="padding: 0px!important;" layout="column">
        <div style="padding: 20px!important;">
            <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12 no-padding">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12  no-padding  form-group detailLabelMD">
                    <div class=" col-lg-4 col-md-4  col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label" ng-if="vm.payment.transaction!=3">Filial:</span>
                        <span class=" bold control-label" ng-if="vm.payment.transaction==3">Tipo de ingreso:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">
                        <span class="  control-label"
                              ng-if="vm.payment.transaction!=3">{{vm.payment.houseNumber}}</span>
                        <span class="  control-label" ng-if="vm.payment.transaction==3">Otro ingreso</span>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding form-group detailLabelMD">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-5 no-padding-left ">
                        <span class=" bold  control-label">Número de recibo:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">

                        <span class="   control-label">{{vm.payment.receiptNumber}}</span>

                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12  no-padding  form-group detailLabelMD">
                    <div class=" col-lg-4 col-md-4  col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Concepto:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">

                        <span class="  control-label">{{vm.payment.concept}}</span>

                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding  form-group detailLabelMD">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Fecha de pago:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">
                        <span class="  control-label">{{vm.payment.date | date: 'longDate'}}</span>
                    </div>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding  form-group detailLabelMD">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Comprobante de pago:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">
                        <span class="control-label" ng-if="vm.payment.paymentProofs.length==0">
                            <span>No tiene</span></span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-8 col-xs-7 ">
                        <span class="control-label" ng-repeat="proof in vm.payment.paymentProofs">
                            <a ng-click="vm.detailProof(proof.id)">{{proof.subject}}</a> <span
                            ng-if="$index+1!=vm.payment.paymentProofs.length">,</span>
                        </span>
                    </div>
                </div>
                <!--                <div has-authority="ROLE_MANAGER" class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding  form-group detailLabelMD">-->
                <!--                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 no-padding-left">-->
                <!--                        <span class=" bold control-label">Enviar recibo a:</span>-->
                <!--                    </div>-->
                <!--                    <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 ">-->
                <!--                    <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 ">-->
                <!--                        <md-input-container class="md-block">-->
                <!--                            <label>Número de cédula</label>-->
                <!--                            <input ng-model="vm.email" type="email">-->
                <!--                        </md-input-container>-->
                <!--                        <md-button class="md-primary md-raised" ng-disabled="!vm.email" ng-click="vm.sendEmail2(vm.payment)">Enviar</md-button>-->
                <!--                    </div>-->
                <!--                </div>-->
            </div>


            <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12 no-padding " >
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding form-group detailLabelMD">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-5 no-padding-left ">
                        <span class=" bold control-label">Método de pago:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7  ">

                        <span class="  control-label">{{vm.payment.paymentMethod }}</span>

                        <!--<input ng-model="vm.egress.expirationDate" id="field_expirationDate" name="expirationDate" ng-click="vm.openCalendar('expirationDate')" ng-change="vm.updatePicker()" enable-time="false" datetime-picker="mediumDate" datepicker-options="vm.picker2.datepickerOptions" is-open="vm.datePickerOpenStatus.expirationDate"-->
                        <!--type="text" class="form-control letters gray-font  dating"  required>-->

                    </div>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12  no-padding  form-group detailLabelMD">
                    <div class=" col-lg-4 col-md-4  col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Cuenta:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">

                        <span class="  control-label">{{vm.payment.account}}</span>

                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding  form-group detailLabelMD">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Referencia bancaria:</span>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-7 ">
                        <span class="control-label">
                             <span ng-if="vm.payment.documentReference">{{vm.payment.documentReference}}</span>
                            <span ng-if="!vm.payment.documentReference">No tiene</span></span>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12  no-padding form-group detailLabelMD">
                    <div class=" col-lg-4 col-md-4  col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Comentarios: </span>
                    </div>
                    <div class="col-lg-7 col-md-7 col-sm-6 col-xs-7 ">

                            <span class="  control-label"
                                  ng-show="vm.payment.comments!==null || vm.payment.comments!==undefined">{{vm.payment.comments}}</span>
                        <span class="  control-label"
                              ng-show="vm.payment.comments==null || vm.payment.comments==undefined">No hay</span>

                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding form-group detailLabelMD hidden-md hidden-lg">
                    <div class=" col-lg-4 col-md-4  col-sm-6 col-xs-5 no-padding-left">
                        <span class=" bold control-label">Total: </span>
                    </div>
                    <div class="col-lg-7 col-md-7 col-sm-6 col-xs-7 ">
                            <span class="control-label">{{fMoney(vm.payment.ammount )}}</span>
                           <span class="pointer">  = {{fMoneyBank('$',vm.payment.ammountDollar)}} <md-tooltip md-direction="bottom">Tipo de cambio en el momento: {{fMoneyBank('₡',vm.payment.exchangeRate)}}</md-tooltip></span>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12  no-padding form-group detailLabelMD"
                     ng-if="vm.payment.ammountPayedSaldoFavor>0">
                    <div class=" col-lg-4 col-md-4  col-sm-4 col-xs-4 no-padding-left">
                        <span class=" bold control-label">Monto cancelado con un saldo a favor anterior: </span>
                    </div>
                    <div class="col-lg-7 col-md-7 col-sm-8 col-xs-8 ">
                        <h4 class="greenBalance bold"> {{fMoney(vm.payment.ammountPayedSaldoFavor )}}
                            <i class="fa fa-info-circle" style="font-size: 16px">
                                <md-tooltip md-direction="bottom">
                                    Cancelado con saldo a favor
                                </md-tooltip>
                            </i></h4>
                    </div>
                </div>

            </div>
            <div class="col-lg-2 col-md-2 col-sm-12 col-xs-8 hidden-xs hidden-sm">
                <h3 class="text-center control-label bold">Total</h3>
                <h2 class="control-label  text-center margin-top-20">{{fMoney(vm.payment.ammount )}}</h2>
                <h5 class="text-center pointer" ng-if="vm.payment.doubleMoney==1">
                    <span> = {{fMoneyBank('$',vm.payment.ammountDollar)}} <md-tooltip md-direction="bottom">Tipo de cambio en el momento: {{fMoneyBank('₡',vm.payment.exchangeRate)}}</md-tooltip></span>
                </h5>
            </div>
        </div>
        <div ng-if="vm.payment.transaction!=3"
             class="margin-top-15 md-inline-form col-md-12 col-lg-12  no-padding fade-in">
            <md-toolbar class="form-title">
                <h2>Cuotas abonadas <i class="fa fa-info-circle" style="font-size: 16px">
                    <md-tooltip md-direction="right">Estos son las cuotas las cuales se abonaron con este pago.
                    </md-tooltip>
                </i></h2>
            </md-toolbar>
            <md-content layout-padding class="form-content no-padding">
                <no-content ng-if="vm.payment.charges.length==0" icon="dvr"
                            text="No existen cuotas canceladas con este adelanto de condómino aún"></no-content>
                <div hide-lg hide-xl ng-show="vm.payment.charges.length>0" class="margin-top-20">
                    <md-card ng-repeat="charge in vm.payment.charges | orderBy: 'date'"
                             md-theme="{{ showDarkTheme ? 'dark-blue' : 'default' }}"
                             class="margin-bottom-20 padding-10"
                             ng-class="{'datePassed': charge.datePassed==true,'firstPassed': charge.definedFirstDatePassed}">
                <span ng-if="charge.definedFirstDatePassed" class="fade-in"
                      style="float:left;margin-top:-23px;margin-left:-10px;z-index:9999">
                        <i ng-if="charge.splited==1" class="material-icons material-icons-with-text"
                           style="color:#4DB3A2;font-size:22px">
                            info<md-tooltip md-direction="bottom" md-visible="tooltipVisible"
                                            class="font-13 bold white-color">Restante de una cuota que se ha pagado parcialmente.</md-tooltip>
                        </i></span>
                        <md-card-title style="padding:3px 7px;">
                            <md-card-title-text>
                            <span class="md-headline font-16 font-green-sharp font-weight-600">{{charge.concept}} <span
                                ng-if="charge.type==6">{{charge.waterConsumption}}</span>
                            <i ng-if="charge.splited==1" class="material-icons material-icons-with-text"
                               style="font-size:22px">
                                info<md-tooltip md-direction="right" md-visible="tooltipVisible"
                                                class="font-13 bold white-color tooltip-multiline ">Este es el restante de una cuota </br>
                                que se ha pagado parcialmente.</md-tooltip>
                            </i>
                            </span>
                            </md-card-title-text>
                        </md-card-title>
                        <md-card-actions layout="row" class="col-md-12 no-padding" layout-align="space-between center">
                            <div class="gray-font">
                                <div style="margin-bottom: 8px;">
                                    Categoría: {{charge.category}}
                                </div>
                                <div>
                                    <div style="margin-bottom: 8px;">
                                        Fecha de cobro: {{charge.date | date}}
                                    </div>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    Abonado: {{fMoney(charge.abonado)}} </b>
                                </div>

                            </div>
                        </md-card-actions>
                    </md-card>
                </div>
                <div ng-show="vm.payment.charges.length!=0" hide-xs hide-md hide-sm>
                    <table class="table  table-hover font-13 tableMaterialDesign">
                        <thead style="background-color: #fafafa;">
                        <tr>
                            <th class="text-center">
                                Factura
                            </th>
                            <th class="text-center">
                                Fecha de cobro
                            </th>
                            <th>
                                Concepto
                            </th>
                            <th>
                                Categoría
                            </th>
                            <th>
                                Total de cuota
                            </th>
                            <th>
                                Abonado
                            </th>
                            <th>
                                Pendiente
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="charge in vm.payment.charges | orderBy: 'date'">
                            <td class="text-center">
                                {{charge.consecutive}}
                            </td>
                            <td class="text-center">
                                {{charge.date | date}}
                            </td>
                            <td class="fade-in">{{charge.concept}} <span ng-if="charge.type==6">{{charge.waterConsumption}}</span>
                            </td>
                            <td class="fade-in">{{charge.category}}</td>
                            <td class="fade-in"> <span ng-if="charge.oldStyle==0">{{fMoney(charge.ammount )}}</span><span ng-if="charge.oldStyle==1">-</span></td>
                            <td class="fade-in"> {{fMoney(charge.abonado )}}</td>
                            <td class="fade-in"> <span ng-if="charge.oldStyle==0">{{fMoney(charge.leftToPay )}}</span><span ng-if="charge.oldStyle==1">-</span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </md-content>
        </div>
    </md-card-content>
</md-card>
<md-fab-speed-dial md-direction="up" style="position: fixed;"
                   class="md-fab md-fab-bottom-right md-fling">
    <md-fab-trigger>
    </md-fab-trigger>
    <md-fab-actions>
        <md-button ng-if="vm.payment.transaction!=3" ng-disabled="vm.exportActions.sendingEmail"
                   class="md-fab md-raised md-mini  orange-button-oficial  float-right" md-colors="indigo"
                   ng-click="vm.sendEmail(vm.payment)">
            <a style="display:block">
                                <span style="margin-top:2px">
                                    <i ng-show="vm.exportActions.sendingEmail==false" style="color:white;font-size:20px"
                                       class="fa fa-envelope" aria-hidden="true"></i>
                                    <i ng-show="vm.exportActions.sendingEmail==true"
                                       style="font-size:18px;color:rgba(255,255,255,0.5)!important"
                                       class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i></span>
            </a>
            <md-tooltip md-direction="left" md-visible="tooltipVisible">Enviar por correo</md-tooltip>
        </md-button>
        <md-button ng-disabled="vm.exportActions.printing"
                   class="md-fab md-raised md-mini  orange-button-oficial  float-right  hidden-xs hidden-sm"
                   ng-click="vm.print(vm.payment.id)">
            <i ng-if="!vm.exportActions.printing" style="font-size:20px;color:white!important"
               class="fa fa-print"></i>
            <i ng-if="vm.exportActions.printing"
               style="font-size:18px;color:rgba(255,255,255,0.5)!important"
               class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i>
            <md-tooltip md-direction="left" md-visible="tooltipVisible">Imprimir</md-tooltip>
        </md-button>
        <md-button ng-disabled="vm.exportActions.downloading"
                   class="md-fab md-raised md-mini orange-button-oficial float-right" md-colors="indigo">
            <a ng-click="vm.download()" style="display:block" href="/api/payments/file/{{vm.payment.id}}" download>
                                <span style="margin-top:2px">
                                    <i ng-show="vm.exportActions.downloading==false" style="color:white;font-size:20px"
                                       class="fa fa-cloud-download" aria-hidden="true"></i>
                                    <i ng-show="vm.exportActions.downloading==true"
                                       style="font-size:18px;color:rgba(255,255,255,0.5)!important"
                                       class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i></span>
            </a>
            <md-tooltip md-direction="left" md-visible="tooltipVisible">Descargar</md-tooltip>
        </md-button>

    </md-fab-actions>
</md-fab-speed-dial>
